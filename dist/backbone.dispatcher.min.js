!function(e,t){"function"==typeof define&&define.amd?define(["backbone","underscore"],function(n,i){return e.Backbone.Dispatcher=t(n,i)}):"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):e.Backbone.Dispatcher=t(e.Backbone,e._)}(this,function(e,t){"use strict";var n=function(n){n&&n.actions&&("string"==typeof n.actions?this.createAction(n.actions):this.createActions(n.actions)),Object.defineProperty(this,"_actions",{enumerable:!1,value:{}}),t.extend(this._actions,e.Events),this.initialize.apply(this,arguments)};return n.extend=e.Model.extend,n.VERSION="0.0.6",n.prototype={initialize:function(){},_prepareAction:function(e,n){var i={};if(t.isString(e)){if(i.name=e,n)if(t.isFunction(n))i.beforeEmit=n;else for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o])}else i=e;return i},createAction:function(e,t){var n,i=this._prepareAction(e,t),o=function(e){this.dispatch(i.name,e)}.bind(this),r=function(e){i.beforeEmit(e,function(e){o(e)})},c=function(e){return function(t){i.shouldEmit(t)&&e(t)}};n=i.shouldEmit?c(i.beforeEmit?r:o):i.beforeEmit?r:o,Object.defineProperty(this,i.name,{enumerable:!1,value:n})},createActions:function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.createAction(e[t])},register:function(e,t,n){if(!t)throw new Error("The listener is undefined!");if(n="function"==typeof n?n:t[n||e],"function"!=typeof n)throw new Error("Cannot register callback `"+n+"` for the action `"+e+"`: the method is undefined on the provided listener object!");this._actions.on(e,n.bind(t))},registerStore:function(e,t,n){var i="string"==typeof n||"function"==typeof n;n=n||e;for(var o,r=0;o=e[r];r++)this.register(o,t,i?n:n[r])},dispatch:function(e,t){this._actions.trigger(e,t)}},n});