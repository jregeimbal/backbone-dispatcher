!function(e,t){"function"==typeof define&&define.amd?define(["backbone","underscore"],t):"object"==typeof exports?module.exports=t(require("backbone"),require("underscore")):e.Backbone.Dispatcher=t(e.Backbone,e._)}(this,function(e,t){var i=root.Dispatcher,n=function(i){i&&i.actions&&("string"==typeof i.actions?this.createAction(i.actions):this.createActions(i.actions)),Object.defineProperty(this,"_actions",{enumerable:!1,value:{}}),t.extend(this._actions,e.Events),this.initialize.apply(this,arguments)};return n.extend=e.Model.extend,n.VERSION="0.0.2",n.noConflict=function(){return root.Dispatcher=i,this},n.prototype={initialize:function(){},_prepareAction:function(e,i){var n={};if(t.isString(e)){if(n.name=e,i)if(t.isFunction(i))n.beforeEmit=i;else for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o])}else n=e;return n},createAction:function(e,t){var i,n=this._prepareAction(e,t),o=this,r=function(e){o.dispatch(n.name,e)},c=function(e){n.beforeEmit(e,function(e){r(e)})},s=function(e){return function(t){n.shouldEmit(t)&&e(t)}};i=n.shouldEmit?s(n.beforeEmit?c:r):n.beforeEmit?c:r,Object.defineProperty(this,n.name,{enumerable:!1,value:i})},createActions:function(e){for(var t in e)this.createAction(e[t])},register:function(e,t,i){i=i||e,this._actions.on(e,t[i].bind(t))},registerStore:function(e,t,i){i=i||e;for(var n=0;n<e.length;n++)this.register(e[n],t,i[n])},dispatch:function(e,t){this._actions.trigger(e,t)}},n});