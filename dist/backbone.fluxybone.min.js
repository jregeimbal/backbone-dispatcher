!function(e,n){"function"==typeof define&&define.amd?define(["backbone","underscore"],n):"object"==typeof exports?module.exports=n(require("backbone"),require("underscore")):e.Backbone.fluxybone=n(e.Backbone,e._)}(this,function(e,n){FluxyBone={};var t=FluxyBone.Dispatcher=function(t){t&&("string"==typeof t?this.createAction(t):this.createActions(t)),Object.defineProperty(this,"_actions",{enumerable:!1,value:{}}),n.extend(this._actions,e.Events)};return t.prototype={_prepareAction:function(e,t){var i={};if(n.isString(e)){if(i.name=e,t)if(n.isFunction(t))i.beforeEmit=t;else for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o])}else i=e;return i},createAction:function(e,n){var t,i=this._prepareAction(e,n),o=this,r=function(){return function(e){o._actions.trigger(i.name,e)}},c=function(){return function(e){i.beforeEmit(e,function(e){r(e)})}},u=function(e){return function(n){i.shouldEmit(n)&&e()(n)}};t=i.shouldEmit?u(i.beforeEmit?c:r):i.beforeEmit?c():r(),Object.defineProperty(this,i.name,{enumerable:!1,value:t})},createActions:function(e){for(var n in e)this.createAction(e[n])},register:function(e,n,t){t=t||e,this._actions.on(e,n[t].bind(n))}},e.FluxyBone=FluxyBone,e.fluxybone});